<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>INA TRAINER</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.js"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Share+Tech+Mono&display=swap');
:root{--bg:#05080f;--panel:#0a1020;--border:#0d2040;--accent:#e040fb;--accent2:#ff3d71;--accent3:#00e5ff;--green:#00ff88;--text:#dce8ff;--dim:#3a4a6a;}
*{margin:0;padding:0;box-sizing:border-box;}
body{background:var(--bg);color:var(--text);font-family:'Share Tech Mono',monospace;height:100vh;overflow:hidden;user-select:none;}
#three-canvas{position:fixed;inset:0;display:none;cursor:none;}
#crosshair{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);pointer-events:none;z-index:50;display:none;}
.ch-line{position:absolute;background:#fff;border-radius:1px;transition:all .06s ease-out;}
.ch-top{width:2px;height:12px;left:50%;top:calc(50% - 20px);transform:translateX(-50%);}
.ch-bottom{width:2px;height:12px;left:50%;top:calc(50% + 8px);transform:translateX(-50%);}
.ch-left{height:2px;width:12px;top:50%;left:calc(50% - 20px);transform:translateY(-50%);}
.ch-right{height:2px;width:12px;top:50%;left:calc(50% + 8px);transform:translateY(-50%);}
.ch-dot{position:absolute;width:3px;height:3px;background:#fff;border-radius:50%;left:50%;top:50%;transform:translate(-50%,-50%);}
#crosshair.shoot .ch-top{top:calc(50% - 26px);}
#crosshair.shoot .ch-bottom{top:calc(50% + 14px);}
#crosshair.shoot .ch-left{left:calc(50% - 26px);}
#crosshair.shoot .ch-right{left:calc(50% + 14px);}
#hud{position:fixed;top:0;left:0;right:0;z-index:40;display:none;justify-content:space-between;align-items:center;padding:12px 28px;background:linear-gradient(180deg,rgba(5,8,15,.95) 0%,transparent 100%);border-bottom:1px solid rgba(224,64,251,.1);}
.hud-block{display:flex;flex-direction:column;align-items:center;gap:2px;}
.hud-lbl{font-size:.55rem;letter-spacing:.3em;color:var(--dim);}
.hud-val{font-family:'Orbitron',monospace;font-size:1.3rem;font-weight:700;color:var(--accent);}
#timer-val{color:var(--accent2);}
#timer-val.warn{animation:blink .5s infinite;}
@keyframes blink{0%,100%{color:var(--accent2);}50%{color:#f00;text-shadow:0 0 15px #f00;}}
.mode-tag{font-family:'Orbitron',monospace;font-size:.58rem;letter-spacing:.2em;padding:3px 10px;border:1px solid var(--accent);color:var(--accent);clip-path:polygon(5px 0,100% 0,calc(100% - 5px) 100%,0 100%);}
#hit-flash{position:fixed;inset:0;pointer-events:none;z-index:45;background:radial-gradient(ellipse at center,rgba(224,64,251,.18) 0%,transparent 70%);opacity:0;transition:opacity .08s;}
#hit-flash.show{opacity:1;}
#bottom-bar{position:fixed;bottom:0;left:0;right:0;z-index:40;display:none;justify-content:space-between;align-items:center;padding:8px 28px;background:linear-gradient(0deg,rgba(5,8,15,.95) 0%,transparent 100%);border-top:1px solid rgba(224,64,251,.08);}
.acc-wrap{flex:1;max-width:300px;margin:0 auto;}
.acc-lbl{font-size:.52rem;letter-spacing:.3em;color:var(--dim);text-align:center;margin-bottom:3px;}
.acc-bg{height:3px;background:var(--border);border-radius:2px;overflow:hidden;}
.acc-fill{height:100%;background:linear-gradient(90deg,var(--accent2),var(--green));border-radius:2px;transition:width .3s;width:0%;}
.quit-btn{background:none;border:1px solid var(--border);color:var(--dim);font-family:'Share Tech Mono',monospace;font-size:.62rem;letter-spacing:.2em;padding:5px 13px;cursor:pointer;transition:all .2s;}
.quit-btn:hover{border-color:var(--accent2);color:var(--accent2);}
#lives-hud{position:fixed;top:56px;right:24px;z-index:41;display:flex;gap:5px;}
.life{color:var(--accent2);font-size:1rem;transition:opacity .3s;}
.life.lost{opacity:.12;}
#combo-disp{position:fixed;top:68px;left:50%;transform:translateX(-50%);font-family:'Orbitron',monospace;font-size:1rem;font-weight:700;letter-spacing:.3em;color:#ffd700;text-shadow:0 0 15px #ffd700;z-index:45;pointer-events:none;opacity:0;transition:opacity .3s;}
#combo-disp.show{opacity:1;}
.screen{position:fixed;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:10;transition:opacity .3s;}
.screen.hidden{opacity:0;pointer-events:none;}
@keyframes glow{0%,100%{text-shadow:0 0 30px var(--accent),0 0 60px rgba(224,64,251,.3);}50%{text-shadow:0 0 50px var(--accent),0 0 100px rgba(224,64,251,.5);}}
#login-screen{gap:0;background:radial-gradient(ellipse at center,rgba(224,64,251,.06) 0%,transparent 70%);}
.login-logo{text-align:center;margin-bottom:28px;}
.login-logo h1{font-family:'Orbitron',monospace;font-size:clamp(2.5rem,6vw,4.5rem);font-weight:900;letter-spacing:.3em;color:var(--accent);animation:glow 3s ease-in-out infinite;}
.login-logo p{font-size:.68rem;letter-spacing:.5em;color:var(--dim);margin-top:6px;}
.auth-box{background:var(--panel);border:1px solid var(--border);padding:0;clip-path:polygon(0 0,calc(100% - 16px) 0,100% 16px,100% 100%,16px 100%,0 calc(100% - 16px));width:380px;overflow:hidden;}
.auth-tabs{display:flex;border-bottom:1px solid var(--border);}
.auth-tab{flex:1;background:none;border:none;color:var(--dim);font-family:'Orbitron',monospace;font-size:.62rem;letter-spacing:.25em;padding:14px 10px;cursor:pointer;transition:all .2s;position:relative;}
.auth-tab::after{content:'';position:absolute;bottom:0;left:0;right:0;height:2px;background:var(--accent);transform:scaleX(0);transition:transform .2s;}
.auth-tab.active{color:var(--accent);background:rgba(224,64,251,.05);}
.auth-tab.active::after{transform:scaleX(1);}
.auth-tab:hover:not(.active){color:var(--text);}
.auth-panel{padding:28px 32px;display:flex;flex-direction:column;gap:14px;}
.avatar-row{display:flex;gap:7px;justify-content:center;flex-wrap:wrap;}
.avatar-opt{font-size:1.4rem;cursor:pointer;padding:4px 8px;border:2px solid transparent;border-radius:8px;transition:all .15s;background:#030608;}
.avatar-opt:hover{border-color:var(--accent);transform:scale(1.1);}
.avatar-opt.selected{border-color:var(--accent);background:rgba(224,64,251,.15);transform:scale(1.15);}
.field-wrap{display:flex;flex-direction:column;gap:5px;}
.field-wrap label{font-size:.56rem;letter-spacing:.3em;color:var(--dim);}
.field-input-row{display:flex;align-items:center;gap:0;position:relative;}
.field-icon{position:absolute;left:12px;color:var(--dim);font-size:.9rem;pointer-events:none;z-index:1;}
.auth-input{background:#030608;border:1px solid var(--border);color:var(--text);font-family:'Share Tech Mono',monospace;font-size:.95rem;padding:11px 12px 11px 36px;outline:none;width:100%;transition:border-color .2s,box-shadow .2s;letter-spacing:.08em;}
.auth-input:focus{border-color:var(--accent);box-shadow:0 0 14px rgba(224,64,251,.18);}
.auth-input.no-icon{padding-left:12px;}
.pw-strength{height:2px;background:var(--border);margin-top:4px;border-radius:1px;overflow:hidden;}
.pw-strength-fill{height:100%;border-radius:1px;transition:width .3s,background .3s;width:0%;}
.auth-submit{background:var(--accent);border:none;color:#000;font-family:'Orbitron',monospace;font-size:.82rem;font-weight:900;letter-spacing:.2em;padding:13px;cursor:pointer;clip-path:polygon(8px 0,100% 0,calc(100% - 8px) 100%,0 100%);transition:all .2s;width:100%;position:relative;overflow:hidden;}
.auth-submit:hover{box-shadow:0 0 30px rgba(224,64,251,.6);}
.auth-submit:disabled{opacity:.5;cursor:not-allowed;box-shadow:none;}
.auth-submit .btn-loader{display:none;position:absolute;inset:0;background:inherit;align-items:center;justify-content:center;}
.auth-submit.loading .btn-loader{display:flex;}
.auth-submit.loading .btn-text{opacity:0;}
@keyframes spin{to{transform:rotate(360deg);}}
.spinner{width:18px;height:18px;border:2px solid rgba(0,0,0,.3);border-top-color:#000;border-radius:50%;animation:spin .6s linear infinite;}
.auth-msg{font-size:.62rem;text-align:center;letter-spacing:.1em;min-height:16px;padding:2px 0;}
.auth-msg.error{color:var(--accent2);}
.auth-msg.success{color:var(--green);}
.auth-divider{display:flex;align-items:center;gap:10px;margin:2px 0;}
.auth-divider::before,.auth-divider::after{content:'';flex:1;height:1px;background:var(--border);}
.auth-divider span{font-size:.52rem;letter-spacing:.2em;color:var(--dim);}
#lb-screen{gap:0;justify-content:flex-start;padding-top:28px;overflow-y:auto;}
.lb-header{font-family:'Orbitron',monospace;font-size:1.4rem;font-weight:900;letter-spacing:.3em;color:var(--accent);margin-bottom:5px;text-align:center;}
.lb-sub{font-size:.6rem;letter-spacing:.3em;color:var(--dim);text-align:center;margin-bottom:18px;}
.lb-wrap{max-width:720px;width:100%;padding:0 20px;}
.lb-tabs{display:flex;gap:7px;margin-bottom:14px;flex-wrap:wrap;justify-content:center;}
.lb-tab{background:var(--panel);border:1px solid var(--border);color:var(--dim);font-family:'Share Tech Mono',monospace;font-size:.6rem;letter-spacing:.15em;padding:7px 13px;cursor:pointer;transition:all .15s;clip-path:polygon(5px 0,100% 0,calc(100% - 5px) 100%,0 100%);}
.lb-tab:hover{border-color:var(--accent);color:var(--accent);}
.lb-tab.active{background:var(--accent);color:#000;border-color:var(--accent);}
.lb-table{width:100%;border-collapse:collapse;}
.lb-table th{font-size:.53rem;letter-spacing:.3em;color:var(--dim);padding:8px 10px;text-align:left;border-bottom:1px solid var(--border);}
.lb-table td{padding:10px 10px;font-size:.73rem;border-bottom:1px solid rgba(13,32,64,.5);transition:background .15s;}
.lb-table tr:hover td{background:rgba(224,64,251,.04);}
.lb-rank{font-family:'Orbitron',monospace;font-weight:700;font-size:.82rem;}
.r1{color:#ffd700;text-shadow:0 0 10px #ffd700;}
.r2{color:#c0c0c0;text-shadow:0 0 8px #c0c0c0;}
.r3{color:#cd7f32;text-shadow:0 0 8px #cd7f32;}
.lb-player{display:flex;align-items:center;gap:8px;}
.lb-score-val{font-family:'Orbitron',monospace;color:var(--accent);font-weight:700;}
.lb-acc{color:var(--green);}
.lb-me td{background:rgba(224,64,251,.06)!important;}
.lb-loading,.lb-empty{text-align:center;color:var(--dim);font-size:.7rem;letter-spacing:.2em;padding:30px;}
.lb-footer{display:flex;gap:10px;justify-content:center;margin-top:18px;margin-bottom:28px;}
#stats-screen{gap:0;justify-content:flex-start;padding-top:26px;overflow-y:auto;}
.stats-hdr{font-family:'Orbitron',monospace;font-size:1.3rem;font-weight:900;letter-spacing:.3em;color:var(--accent);margin-bottom:16px;text-align:center;}
.stats-wrap{max-width:660px;width:100%;padding:0 20px;}
.profile-card{background:var(--panel);border:1px solid var(--border);padding:18px 22px;margin-bottom:14px;clip-path:polygon(0 0,calc(100% - 10px) 0,100% 10px,100% 100%,10px 100%,0 calc(100% - 10px));display:flex;align-items:center;gap:14px;}
.profile-avatar{font-size:2.4rem;}
.profile-info h2{font-family:'Orbitron',monospace;font-size:1rem;color:var(--text);letter-spacing:.1em;}
.profile-info p{font-size:.6rem;color:var(--dim);letter-spacing:.2em;margin-top:3px;}
.stats-cards{display:grid;grid-template-columns:repeat(3,1fr);gap:9px;margin-bottom:12px;}
.st-card{background:var(--panel);border:1px solid var(--border);padding:13px;text-align:center;clip-path:polygon(0 0,calc(100% - 7px) 0,100% 7px,100% 100%,7px 100%,0 calc(100% - 7px));}
.st-val{font-family:'Orbitron',monospace;font-size:1.3rem;font-weight:700;color:var(--accent);margin-bottom:3px;}
.st-lbl{font-size:.54rem;letter-spacing:.2em;color:var(--dim);}
.mode-records{background:var(--panel);border:1px solid var(--border);padding:15px 18px;clip-path:polygon(0 0,calc(100% - 8px) 0,100% 8px,100% 100%,8px 100%,0 calc(100% - 8px));}
.mr-title{font-family:'Orbitron',monospace;font-size:.58rem;letter-spacing:.3em;color:var(--accent);margin-bottom:10px;padding-bottom:5px;border-bottom:1px solid var(--border);}
.mr-row{display:flex;justify-content:space-between;align-items:center;padding:6px 0;border-bottom:1px solid rgba(13,32,64,.4);}
.mr-row:last-child{border-bottom:none;}
.mr-mode{font-size:.66rem;color:var(--text);}
.mr-score{font-family:'Orbitron',monospace;font-size:.78rem;color:var(--accent);font-weight:700;}
.mr-acc{font-size:.62rem;color:var(--green);}
.stats-footer{display:flex;gap:10px;justify-content:center;margin-top:16px;margin-bottom:28px;}
#menu-screen{gap:0;background:radial-gradient(ellipse at center,rgba(224,64,251,.04) 0%,transparent 70%);}
.logo{text-align:center;margin-bottom:20px;}
.logo h1{font-family:'Orbitron',monospace;font-size:clamp(2rem,5vw,4rem);font-weight:900;letter-spacing:.3em;color:var(--accent);animation:glow 3s ease-in-out infinite;}
.logo p{font-size:.7rem;letter-spacing:.5em;color:var(--dim);margin-top:5px;}
.sec-lbl{font-size:.58rem;letter-spacing:.4em;color:var(--dim);margin-bottom:12px;text-align:center;}
.modes-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:9px;max-width:880px;width:100%;padding:0 20px;margin-bottom:18px;}
.mode-card{background:var(--panel);border:1px solid var(--border);cursor:pointer;overflow:hidden;transition:all .2s;clip-path:polygon(0 0,calc(100% - 8px) 0,100% 8px,100% 100%,8px 100%,0 calc(100% - 8px));}
.mode-card:hover{transform:translateY(-3px);border-color:rgba(224,64,251,.4);}
.mode-card.selected{border-color:var(--accent);box-shadow:0 0 18px rgba(224,64,251,.25);}
.mode-prev{height:60px;background:#030608;position:relative;overflow:hidden;}
.mode-prev canvas{width:100%;height:100%;display:block;}
.mode-info{padding:8px 10px;}
.m-tag{font-size:.47rem;letter-spacing:.3em;color:var(--dim);margin-bottom:2px;}
.m-name{font-family:'Orbitron',monospace;font-size:.68rem;font-weight:700;color:var(--text);}
.mode-card.selected .m-name{color:var(--accent);}
.m-desc{font-size:.5rem;color:var(--dim);margin-top:2px;line-height:1.5;}
.bot-row{display:flex;gap:9px;align-items:center;flex-wrap:wrap;justify-content:center;max-width:880px;width:100%;padding:0 20px;}
.diff-btn{background:var(--panel);border:1px solid var(--border);color:var(--dim);font-family:'Share Tech Mono',monospace;font-size:.63rem;letter-spacing:.2em;padding:8px 16px;cursor:pointer;transition:all .15s;clip-path:polygon(6px 0,100% 0,calc(100% - 6px) 100%,0 100%);}
.diff-btn:hover{border-color:var(--accent);color:var(--accent);}
.diff-btn.act{background:var(--accent);color:#000;border-color:var(--accent);font-weight:700;}
.diff-btn[data-d="easy"].act{background:var(--green);border-color:var(--green);}
.diff-btn[data-d="hard"].act{background:var(--accent2);border-color:var(--accent2);}
.start-btn{background:var(--accent);border:none;color:#000;font-family:'Orbitron',monospace;font-size:.8rem;font-weight:900;letter-spacing:.2em;padding:11px 30px;cursor:pointer;clip-path:polygon(8px 0,100% 0,calc(100% - 8px) 100%,0 100%);transition:all .15s;margin-left:8px;}
.start-btn:hover{box-shadow:0 0 28px rgba(224,64,251,.6);transform:scale(1.03);}
.cfg-btn{background:none;border:1px solid var(--border);color:var(--dim);font-family:'Share Tech Mono',monospace;font-size:.6rem;letter-spacing:.15em;padding:8px 13px;cursor:pointer;transition:all .15s;}
.cfg-btn:hover{border-color:var(--accent3);color:var(--accent3);}
.menu-extra-row{display:flex;gap:8px;margin-top:10px;flex-wrap:wrap;justify-content:center;}
.extra-btn{background:var(--panel);border:1px solid var(--border);color:var(--dim);font-family:'Share Tech Mono',monospace;font-size:.58rem;letter-spacing:.15em;padding:7px 13px;cursor:pointer;transition:all .15px;clip-path:polygon(5px 0,100% 0,calc(100% - 5px) 100%,0 100%);}
.extra-btn:hover{border-color:var(--accent3);color:var(--accent3);}
.user-badge{display:flex;align-items:center;gap:7px;background:var(--panel);border:1px solid rgba(224,64,251,.3);padding:7px 13px;clip-path:polygon(5px 0,100% 0,calc(100% - 5px) 100%,0 100%);}
.user-badge span{font-size:.63rem;color:var(--text);letter-spacing:.1em;}
#settings-screen{gap:0;justify-content:flex-start;padding-top:26px;overflow-y:auto;}
.cfg-hdr{font-family:'Orbitron',monospace;font-size:1.3rem;font-weight:900;letter-spacing:.3em;color:var(--accent);margin-bottom:16px;text-align:center;}
.cfg-grid{display:grid;grid-template-columns:1fr 1fr;gap:11px;max-width:700px;width:100%;padding:0 20px;}
.cfg-group{background:var(--panel);border:1px solid var(--border);padding:15px;clip-path:polygon(0 0,calc(100% - 8px) 0,100% 8px,100% 100%,8px 100%,0 calc(100% - 8px));}
.cg-title{font-family:'Orbitron',monospace;font-size:.55rem;letter-spacing:.3em;color:var(--accent);margin-bottom:11px;padding-bottom:5px;border-bottom:1px solid var(--border);}
.cfg-row{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;gap:8px;}
.cfg-row:last-child{margin-bottom:0;}
.c-lbl{font-size:.64rem;color:var(--text);}
.c-sub{font-size:.52rem;color:var(--dim);display:block;margin-top:1px;}
.sl-wrap{display:flex;align-items:center;gap:5px;flex:1;justify-content:flex-end;}
input[type=range]{-webkit-appearance:none;height:3px;background:var(--border);border-radius:2px;outline:none;width:95px;cursor:pointer;}
input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:11px;height:11px;border-radius:50%;background:var(--accent);box-shadow:0 0 6px var(--accent);cursor:pointer;border:2px solid var(--bg);}
.sv{font-family:'Orbitron',monospace;font-size:.66rem;color:var(--accent);min-width:30px;text-align:right;}
.toggle{position:relative;width:36px;height:20px;cursor:pointer;flex-shrink:0;}
.toggle input{display:none;}
.ttrack{position:absolute;inset:0;background:var(--border);border-radius:10px;border:1px solid var(--dim);transition:background .2s;}
.toggle input:checked~.ttrack{background:var(--accent);border-color:var(--accent);}
.tthumb{position:absolute;top:3px;left:3px;width:14px;height:14px;background:#fff;border-radius:50%;transition:transform .2s;}
.toggle input:checked~.tthumb{transform:translateX(16px);}
.color-opts{display:flex;gap:5px;}
.color-opt{width:17px;height:17px;border-radius:50%;cursor:pointer;border:2px solid transparent;transition:transform .15s,border-color .15s;}
.color-opt:hover{transform:scale(1.2);}
.color-opt.active{border-color:#fff;transform:scale(1.15);}
.cfg-footer{margin-top:14px;display:flex;gap:11px;margin-bottom:26px;}
#results-screen{gap:20px;}
#results-screen h2{font-family:'Orbitron',monospace;font-size:1.5rem;font-weight:900;letter-spacing:.3em;color:var(--accent);text-shadow:0 0 20px var(--accent);}
.stats-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;max-width:480px;width:100%;padding:0 20px;}
.stat-card{background:var(--panel);border:1px solid var(--border);padding:12px;text-align:center;clip-path:polygon(0 0,calc(100% - 7px) 0,100% 7px,100% 100%,7px 100%,0 calc(100% - 7px));}
.s-val{font-family:'Orbitron',monospace;font-size:1.3rem;font-weight:700;color:var(--accent);margin-bottom:3px;}
.s-lbl{font-size:.54rem;letter-spacing:.2em;color:var(--dim);}
.grade{font-family:'Orbitron',monospace;font-size:3.6rem;font-weight:900;animation:glow 2s infinite;}
.btn-row{display:flex;gap:11px;}
.btn{font-family:'Orbitron',monospace;font-size:.7rem;letter-spacing:.15em;padding:11px 22px;border:none;cursor:pointer;clip-path:polygon(0 0,calc(100% - 8px) 0,100% 8px,100% 100%,8px 100%,0 calc(100% - 8px));transition:all .2s;}
.btn-p{background:var(--accent);color:#000;font-weight:700;}
.btn-p:hover{box-shadow:0 0 25px var(--accent);}
.btn-s{background:transparent;color:var(--text);border:1px solid var(--border);}
.btn-s:hover{border-color:var(--accent);color:var(--accent);}
#lock-overlay{position:fixed;inset:0;z-index:80;background:rgba(5,8,15,.92);display:flex;flex-direction:column;align-items:center;justify-content:center;gap:20px;}
#lock-overlay h2{font-family:'Orbitron',monospace;font-size:1.3rem;letter-spacing:.2em;color:var(--accent);text-shadow:0 0 20px var(--accent);}
#lock-overlay p{font-size:.7rem;letter-spacing:.15em;color:var(--dim);text-align:center;line-height:1.8;}
.lock-btn{background:var(--accent);border:none;color:#000;font-family:'Orbitron',monospace;font-size:.85rem;font-weight:900;letter-spacing:.2em;padding:13px 36px;cursor:pointer;clip-path:polygon(8px 0,100% 0,calc(100% - 8px) 100%,0 100%);transition:box-shadow .2s;}
.lock-btn:hover{box-shadow:0 0 30px var(--accent);}
#pause-menu-btn:hover{border-color:var(--accent3)!important;color:var(--accent3)!important;}
#pause-quit-btn:hover{border-color:var(--accent2)!important;background:rgba(255,61,113,.08)!important;}
.room-card{background:var(--panel);border:1px solid var(--border);padding:10px 14px;display:flex;align-items:center;justify-content:space-between;clip-path:polygon(0 0,calc(100% - 7px) 0,100% 7px,100% 100%,7px 100%,0 calc(100% - 7px));transition:border-color .15s;}
.room-card:hover{border-color:rgba(255,61,113,.4);}
.room-nm{font-family:'Orbitron',monospace;font-size:.7rem;color:var(--text);}
.room-join{background:#ff3d71;border:none;color:#fff;font-family:'Orbitron',monospace;font-size:.58rem;letter-spacing:.15em;padding:7px 14px;cursor:pointer;clip-path:polygon(5px 0,100% 0,calc(100% - 5px) 100%,0 100%);transition:box-shadow .15s;}
.room-join:hover{box-shadow:0 0 12px rgba(255,61,113,.5);}
.player-slot{background:rgba(255,255,255,.03);border:1px solid var(--border);padding:7px 12px;display:flex;align-items:center;gap:8px;clip-path:polygon(0 0,calc(100% - 5px) 0,100% 5px,100% 100%,5px 100%,0 calc(100% - 5px));}
#duel-chat-msgs::-webkit-scrollbar{width:4px;}
#duel-chat-msgs::-webkit-scrollbar-track{background:transparent;}
#duel-chat-msgs::-webkit-scrollbar-thumb{background:var(--border);border-radius:2px;}
@keyframes ping-pulse{0%,100%{opacity:1;}50%{opacity:.5;}}
.ping-bad{animation:ping-pulse .8s infinite;}
@keyframes slideIn{from{opacity:0;transform:translateY(10px);}to{opacity:1;transform:translateY(0);}}
.auth-panel{animation:slideIn .25s ease-out;}
#mobile-controls{position:fixed;inset:0;z-index:55;pointer-events:none;display:none;}
#mobile-controls.active{display:block;}
#joy-zone{position:absolute;left:0;bottom:0;width:50%;height:55%;pointer-events:all;}
#joy-base{position:absolute;width:120px;height:120px;border-radius:50%;background:rgba(255,255,255,.08);border:2px solid rgba(255,255,255,.2);transform:translate(-50%,-50%);display:none;transition:opacity .15s;}
#joy-knob{position:absolute;width:50px;height:50px;border-radius:50%;background:rgba(224,64,251,.7);box-shadow:0 0 18px rgba(224,64,251,.5);border:2px solid rgba(224,64,251,.9);transform:translate(-50%,-50%);display:none;transition:box-shadow .1s;}
#look-zone{position:absolute;right:0;bottom:0;width:50%;height:100%;pointer-events:all;}
#btn-fire{position:absolute;right:24px;bottom:90px;width:80px;height:80px;border-radius:50%;background:rgba(255,61,113,.25);border:3px solid rgba(255,61,113,.7);color:#ff3d71;font-size:1.8rem;display:flex;align-items:center;justify-content:center;pointer-events:all;cursor:pointer;transition:all .1s;-webkit-tap-highlight-color:transparent;user-select:none;}
#btn-fire:active{background:rgba(255,61,113,.55);transform:scale(.9);box-shadow:0 0 24px rgba(255,61,113,.6);}
#btn-jump{position:absolute;right:120px;bottom:90px;width:60px;height:60px;border-radius:50%;background:rgba(0,229,255,.15);border:2px solid rgba(0,229,255,.5);color:#00e5ff;font-size:1.3rem;display:flex;align-items:center;justify-content:center;pointer-events:all;cursor:pointer;transition:all .1s;-webkit-tap-highlight-color:transparent;user-select:none;}
#btn-jump:active{background:rgba(0,229,255,.4);transform:scale(.9);}
#btn-pause-mob{position:absolute;top:14px;left:50%;transform:translateX(-50%);background:rgba(5,8,15,.75);border:1px solid rgba(224,64,251,.3);color:var(--accent);font-family:'Orbitron',monospace;font-size:.62rem;letter-spacing:.2em;padding:8px 16px;pointer-events:all;cursor:pointer;clip-path:polygon(6px 0,100% 0,calc(100% - 6px) 100%,0 100%);-webkit-tap-highlight-color:transparent;}
.mob-toggle-btn{background:rgba(0,229,255,.1);border:1px solid rgba(0,229,255,.4);color:var(--accent3);font-family:'Orbitron',monospace;font-size:.65rem;font-weight:700;letter-spacing:.2em;padding:10px 22px;cursor:pointer;clip-path:polygon(7px 0,100% 0,calc(100% - 7px) 100%,0 100%);transition:all .2s;-webkit-tap-highlight-color:transparent;}
.mob-toggle-btn:hover,.mob-toggle-btn:active{background:rgba(0,229,255,.25);box-shadow:0 0 18px rgba(0,229,255,.3);}
.mob-toggle-btn.on{background:rgba(0,229,255,.25);border-color:var(--accent3);box-shadow:0 0 14px rgba(0,229,255,.35);}
#duel-mobile-controls{position:fixed;inset:0;z-index:56;pointer-events:none;display:none;}
#duel-mobile-controls.active{display:block !important;}
#duel-damage-flash{position:fixed;inset:0;pointer-events:none;z-index:45;background:radial-gradient(ellipse at center,rgba(255,0,0,.25) 0%,transparent 70%);opacity:0;transition:opacity .08s;}
#duel-damage-flash.show{opacity:1;}
</style>
</head>
<body>
<canvas id="three-canvas"></canvas>
<div id="crosshair"><div class="ch-line ch-top"></div><div class="ch-line ch-bottom"></div><div class="ch-line ch-left"></div><div class="ch-line ch-right"></div><div class="ch-dot"></div></div>
<div id="hit-flash"></div>
<div id="hud">
  <div class="hud-block"><span class="hud-lbl">PUNTUACI√ìN</span><span class="hud-val" id="score-val">0</span></div>
  <div style="display:flex;flex-direction:column;align-items:center;gap:4px">
    <span class="hud-lbl">TIEMPO</span><span class="hud-val" id="timer-val">60</span>
    <span class="mode-tag" id="mode-tag">CLICKING</span>
  </div>
  <div class="hud-block"><span class="hud-lbl">DISPAROS / ACIERTOS</span><span class="hud-val" id="shots-val">0 / 0</span></div>
  <div class="hud-block" id="fps-block" style="position:fixed;top:12px;right:28px;text-align:right;"><span class="hud-lbl">FPS</span><span class="hud-val" id="fps-val" style="color:var(--green);font-size:1rem;">‚Äî</span></div>
</div>
<div id="lives-hud"><span class="life" id="lf1">‚ô•</span><span class="life" id="lf2">‚ô•</span><span class="life" id="lf3">‚ô•</span></div>
<div id="combo-disp">‚ú¶ COMBO x<span id="combo-num">0</span></div>
<div id="bottom-bar">
  <div style="font-size:.55rem;letter-spacing:.2em;color:var(--dim)">PRECISI√ìN</div>
  <div class="acc-wrap"><div class="acc-lbl">ACCURACY ¬∑ <span id="acc-pct">0</span>%</div><div class="acc-bg"><div class="acc-fill" id="acc-fill"></div></div></div>
  <button class="quit-btn" id="quit-btn">[ SALIR]</button>
</div>
<div id="mobile-controls">
  <div id="joy-zone"><div id="joy-base"></div><div id="joy-knob"></div></div>
  <div id="look-zone"></div>
  <div id="btn-fire">üî¥</div>
  <div id="btn-jump">‚¨Ü</div>
  <button id="btn-pause-mob">‚è∏ PAUSA</button>
</div>
<div id="lock-overlay" style="display:none">
  <h2>üéØ INA TRAINER</h2>
  <p id="lock-hint">Mueve el mouse para apuntar<br>Clic izquierdo para disparar<br>Presiona <strong style="color:var(--accent)">ESC</strong> para pausar</p>
  <button class="lock-btn" id="lock-btn">üñ± CLIC PARA JUGAR</button>
  <button class="mob-toggle-btn" id="mob-toggle-btn" style="margin-top:4px">üì± MODO M√ìVIL</button>
  <div style="font-size:.56rem;letter-spacing:.2em;color:var(--dim);margin-top:6px">MODO: <span id="lock-mode-name" style="color:var(--accent)">‚Äî</span></div>
</div>
<div id="pause-overlay" style="display:none;position:fixed;inset:0;z-index:90;background:rgba(5,8,15,.88);backdrop-filter:blur(6px);display:none;flex-direction:column;align-items:center;justify-content:center;gap:18px;">
  <div style="font-family:'Orbitron',monospace;font-size:2rem;font-weight:900;letter-spacing:.4em;color:var(--accent);text-shadow:0 0 30px var(--accent);">‚è∏ PAUSA</div>
  <div style="font-size:.65rem;letter-spacing:.3em;color:var(--dim);">MODO: <span id="pause-mode-name" style="color:var(--accent)">‚Äî</span></div>
  <div style="display:flex;flex-direction:column;align-items:center;gap:10px;margin-top:10px;">
    <button id="pause-resume-btn" class="lock-btn" style="width:240px;font-size:.8rem;">‚ñ∂ REANUDAR</button>
    <button id="pause-menu-btn" style="width:240px;background:none;border:1px solid var(--border);color:var(--dim);font-family:'Orbitron',monospace;font-size:.72rem;font-weight:700;letter-spacing:.2em;padding:13px;cursor:pointer;clip-path:polygon(8px 0,100% 0,calc(100% - 8px) 100%,0 100%);transition:all .2s;">‚ò∞ IR AL MEN√ö</button>
    <button id="pause-quit-btn" style="width:240px;background:none;border:1px solid rgba(255,61,113,.35);color:var(--accent2);font-family:'Orbitron',monospace;font-size:.72rem;font-weight:700;letter-spacing:.2em;padding:13px;cursor:pointer;clip-path:polygon(8px 0,100% 0,calc(100% - 8px) 100%,0 100%);transition:all .2s;">‚úï SALIR DE LA PARTIDA</button>
  </div>
  <div style="font-size:.54rem;letter-spacing:.25em;color:var(--dim);margin-top:6px">Presiona <strong style="color:var(--accent)">ESC</strong> o haz clic en Reanudar para continuar</div>
</div>
<!-- LOGIN -->
<div class="screen" id="login-screen">
  <div class="login-logo"><h1>INA TRAINER</h1><p>ENTRENADOR FPS 3D ¬∑ COMPETITIVO</p></div>
  <div class="auth-box">
    <div class="auth-tabs">
      <button class="auth-tab active" id="tab-login" onclick="switchTab('login')">‚ö° INICIAR SESI√ìN</button>
      <button class="auth-tab" id="tab-register" onclick="switchTab('register')">‚ú¶ REGISTRARSE</button>
    </div>
    <div class="auth-panel" id="panel-login">
      <div class="field-wrap"><label>USUARIO</label><div class="field-input-row"><span class="field-icon">‚óà</span><input class="auth-input" id="login-username" type="text" placeholder="Tu nombre de usuario" maxlength="20" autocomplete="username" autocorrect="off" autocapitalize="off"></div></div>
      <div class="field-wrap"><label>CONTRASE√ëA</label><div class="field-input-row"><span class="field-icon">üîí</span><input class="auth-input" id="login-password" type="password" placeholder="Tu contrase√±a" maxlength="40" autocomplete="current-password"></div></div>
      <div class="auth-msg" id="login-msg"></div>
      <button class="auth-submit" id="login-submit" onclick="doLogin()"><span class="btn-text">‚ñ∂ ENTRAR</span><div class="btn-loader"><div class="spinner"></div></div></button>
      <div class="auth-divider"><span>¬øA√∫n no tienes cuenta?</span></div>
      <button style="background:none;border:1px solid var(--border);color:var(--dim);font-family:'Share Tech Mono',monospace;font-size:.6rem;letter-spacing:.15em;padding:9px;cursor:pointer;transition:all .2s;width:100%" onmouseover="this.style.borderColor='var(--accent)';this.style.color='var(--accent)'" onmouseout="this.style.borderColor='var(--border)';this.style.color='var(--dim)'" onclick="switchTab('register')">CREAR CUENTA GRATIS ‚Üí</button>
    </div>
    <div class="auth-panel" id="panel-register" style="display:none">
      <div class="field-wrap"><label>ELIGE TU AVATAR</label><div class="avatar-row" id="avatar-row"><span class="avatar-opt selected" data-av="üéØ">üéØ</span><span class="avatar-opt" data-av="üî´">üî´</span><span class="avatar-opt" data-av="‚ö°">‚ö°</span><span class="avatar-opt" data-av="üê∫">üê∫</span><span class="avatar-opt" data-av="ü¶ä">ü¶ä</span><span class="avatar-opt" data-av="üíÄ">üíÄ</span><span class="avatar-opt" data-av="üêâ">üêâ</span><span class="avatar-opt" data-av="ü§ñ">ü§ñ</span><span class="avatar-opt" data-av="üëæ">üëæ</span><span class="avatar-opt" data-av="üéÆ">üéÆ</span></div></div>
      <div class="field-wrap"><label>NOMBRE DE USUARIO <span style="color:var(--dim);font-size:.5rem">(m√≠n. 3 caracteres)</span></label><div class="field-input-row"><span class="field-icon">‚óà</span><input class="auth-input" id="reg-username" type="text" placeholder="Elige un nombre √∫nico" maxlength="20" autocomplete="off" autocorrect="off" autocapitalize="off" oninput="checkUsernameAvail()"></div><div style="font-size:.54rem;letter-spacing:.1em;min-height:14px;margin-top:2px" id="username-avail"></div></div>
      <div class="field-wrap"><label>CONTRASE√ëA <span style="color:var(--dim);font-size:.5rem">(m√≠n. 6 caracteres)</span></label><div class="field-input-row"><span class="field-icon">üîí</span><input class="auth-input" id="reg-password" type="password" placeholder="Elige una contrase√±a" maxlength="40" autocomplete="new-password" oninput="updatePwStrength()"></div><div class="pw-strength"><div class="pw-strength-fill" id="pw-strength-fill"></div></div></div>
      <div class="field-wrap"><label>CONFIRMAR CONTRASE√ëA</label><div class="field-input-row"><span class="field-icon">üîí</span><input class="auth-input" id="reg-confirm" type="password" placeholder="Repite la contrase√±a" maxlength="40" autocomplete="new-password"></div></div>
      <div class="auth-msg" id="register-msg"></div>
      <button class="auth-submit" id="register-submit" onclick="doRegister()"><span class="btn-text">‚ú¶ CREAR CUENTA</span><div class="btn-loader"><div class="spinner"></div></div></button>
    </div>
  </div>
</div>
<!-- LEADERBOARD -->
<div class="screen hidden" id="lb-screen">
  <div class="lb-header">üèÜ TABLA DE R√âCORDS</div><div class="lb-sub">MEJORES JUGADORES GLOBALES</div>
  <div class="lb-wrap">
    <div class="lb-tabs" id="lb-tabs"><button class="lb-tab active" data-mode="all">TODOS</button><button class="lb-tab" data-mode="clicking">CLICKING</button><button class="lb-tab" data-mode="flicking">FLICKING</button><button class="lb-tab" data-mode="micro">MICRO</button><button class="lb-tab" data-mode="gridshot">GRIDSHOT</button><button class="lb-tab" data-mode="strafe">STRAFE</button><button class="lb-tab" data-mode="wide">WIDE</button></div>
    <table class="lb-table"><thead><tr><th>#</th><th>JUGADOR</th><th>PUNTUACI√ìN</th><th>PRECISI√ìN</th><th>MODO</th><th>DIFICULTAD</th></tr></thead><tbody id="lb-body"><tr><td colspan="6" class="lb-loading">‚ü≥ CARGANDO...</td></tr></tbody></table>
    <div class="lb-footer"><button class="btn btn-s" id="lb-refresh-btn">‚Ü∫ ACTUALIZAR</button><button class="btn btn-p" id="lb-back-btn">‚Üê VOLVER</button></div>
  </div>
</div>
<!-- STATS -->
<div class="screen hidden" id="stats-screen">
  <div class="stats-hdr">üìä MIS ESTAD√çSTICAS</div>
  <div class="stats-wrap">
    <div class="profile-card"><div class="profile-avatar" id="profile-av">üéØ</div><div class="profile-info"><h2 id="profile-name">‚Äî</h2><p>JUGADOR INA TRAINER</p></div></div>
    <div class="stats-cards">
      <div class="st-card"><div class="st-val" id="st-games">0</div><div class="st-lbl">PARTIDAS</div></div>
      <div class="st-card"><div class="st-val" id="st-best">0</div><div class="st-lbl">MEJOR PUNTUACI√ìN</div></div>
      <div class="st-card"><div class="st-val" id="st-acc">0%</div><div class="st-lbl">PRECISI√ìN MEDIA</div></div>
      <div class="st-card"><div class="st-val" id="st-hits">0</div><div class="st-lbl">TOTAL ACIERTOS</div></div>
      <div class="st-card"><div class="st-val" id="st-shots">0</div><div class="st-lbl">TOTAL DISPAROS</div></div>
      <div class="st-card"><div class="st-val" id="st-combo">0</div><div class="st-lbl">MEJOR COMBO</div></div>
    </div>
    <div class="mode-records"><div class="mr-title">‚ú¶ R√âCORDS POR MODO</div><div id="mr-rows"></div></div>
    <div class="stats-footer"><button class="btn btn-p" id="stats-back-btn">‚Üê VOLVER</button></div>
  </div>
</div>
<!-- MENU -->
<div class="screen hidden" id="menu-screen">
  <div class="logo"><h1>INA TRAINER</h1><p>ENTRENADOR FPS 3D</p></div>
  <div id="menu-online-badge" style="display:flex;align-items:center;gap:7px;margin-bottom:6px;background:rgba(0,255,136,.06);border:1px solid rgba(0,255,136,.2);padding:5px 14px;clip-path:polygon(5px 0,100% 0,calc(100% - 5px) 100%,0 100%)">
    <span style="width:7px;height:7px;border-radius:50%;background:#00ff88;box-shadow:0 0 6px #00ff88;display:inline-block;animation:ping-pulse 2s infinite"></span>
    <span style="font-size:.58rem;letter-spacing:.2em;color:#00ff88"><span id="menu-online-count">‚Äî</span> JUGANDO AHORA</span>
  </div>
  <div class="sec-lbl">‚Äî SELECCIONA MODO ‚Äî</div>
  <div class="modes-grid" id="modes-grid"></div>
  <div class="bot-row">
    <div class="sec-lbl" style="margin:0 6px 0 0">DIFICULTAD:</div>
    <button class="diff-btn" data-d="easy">F√ÅCIL</button>
    <button class="diff-btn act" data-d="medium">MEDIO</button>
    <button class="diff-btn" data-d="hard">DIF√çCIL</button>
    <button class="start-btn" id="start-btn">‚ñ∂ JUGAR</button>
    <button class="cfg-btn" id="open-cfg-btn">‚öô CFG</button>
  </div>
  <div class="menu-extra-row">
    <div class="user-badge"><span id="menu-user-av">üéØ</span><span id="menu-user-name">‚Äî</span></div>
    <button class="extra-btn" id="open-lb-btn">üèÜ R√âCORDS</button>
    <button class="extra-btn" id="open-stats-btn">üìä ESTAD√çSTICAS</button>
    <button class="extra-btn" id="logout-btn">‚èè CERRAR SESI√ìN</button>
  </div>
  <div class="menu-extra-row" style="margin-top:8px">
    <button id="open-1v1-btn" style="background:linear-gradient(135deg,#ff3d71,#e040fb);border:none;color:#fff;font-family:'Orbitron',monospace;font-size:.78rem;font-weight:900;letter-spacing:.2em;padding:11px 28px;cursor:pointer;clip-path:polygon(8px 0,100% 0,calc(100% - 8px) 100%,0 100%);transition:all .2s;box-shadow:0 0 20px rgba(224,64,251,.3);">‚öî 1v1 ONLINE</button>
    <button class="mob-toggle-btn" id="mob-toggle-menu-btn">üì± MODO M√ìVIL</button>
  </div>
</div>
<!-- SETTINGS -->
<div class="screen hidden" id="settings-screen">
  <div class="cfg-hdr">‚öô CONFIGURACI√ìN</div>
  <div class="cfg-grid">
    <div class="cfg-group">
      <div class="cg-title">‚ú¶ MIRA</div>
      <div class="cfg-row"><span class="c-lbl">Color</span><div class="color-opts" id="ch-colors"><div class="color-opt active" data-c="#ffffff" style="background:#fff"></div><div class="color-opt" data-c="#00e5ff" style="background:#00e5ff"></div><div class="color-opt" data-c="#00ff88" style="background:#00ff88"></div><div class="color-opt" data-c="#ff3d71" style="background:#ff3d71"></div><div class="color-opt" data-c="#ffd700" style="background:#ffd700"></div><div class="color-opt" data-c="#e040fb" style="background:#e040fb"></div></div></div>
      <div class="cfg-row"><div><span class="c-lbl">Tama√±o</span></div><div class="sl-wrap"><input type="range" id="ch-size" min="6" max="24" value="12"><span class="sv" id="ch-size-v">12</span></div></div>
      <div class="cfg-row"><div><span class="c-lbl">Grosor</span></div><div class="sl-wrap"><input type="range" id="ch-thick" min="1" max="5" value="2"><span class="sv" id="ch-thick-v">2</span></div></div>
      <div class="cfg-row"><div><span class="c-lbl">Separaci√≥n</span></div><div class="sl-wrap"><input type="range" id="ch-gap" min="2" max="16" value="8"><span class="sv" id="ch-gap-v">8</span></div></div>
      <div class="cfg-row"><span class="c-lbl">Punto central</span><label class="toggle"><input type="checkbox" id="ch-dot" checked><div class="ttrack"></div><div class="tthumb"></div></label></div>
    </div>
    <div class="cfg-group">
      <div class="cg-title">üéÆ C√ÅMARA / JUEGO</div>
      <div class="cfg-row"><div><span class="c-lbl">Sensibilidad</span><span class="c-sub">Aplica a modo pr√°ctica Y PVP</span></div><div class="sl-wrap"><input type="range" id="sens-sl" min="1" max="100" value="30"><span class="sv" id="sens-v">3.0</span></div></div>
      <div class="cfg-row"><div><span class="c-lbl">Tama√±o objetivos</span></div><div class="sl-wrap"><input type="range" id="tgt-size" min="50" max="200" value="100" step="10"><span class="sv" id="tgt-size-v">1.0x</span></div></div>
      <div class="cfg-row"><div><span class="c-lbl">Velocidad</span></div><div class="sl-wrap"><input type="range" id="tgt-spd" min="50" max="300" value="100" step="10"><span class="sv" id="tgt-spd-v">1.0x</span></div></div>
      <div class="cfg-row"><div><span class="c-lbl">M√°x. objetivos</span></div><div class="sl-wrap"><input type="range" id="tgt-max" min="1" max="8" value="4"><span class="sv" id="tgt-max-v">4</span></div></div>
    </div>
    <div class="cfg-group">
      <div class="cg-title">‚óà VISUAL</div>
      <div class="cfg-row"><span class="c-lbl">Efectos de impacto</span><label class="toggle"><input type="checkbox" id="fx-tog" checked><div class="ttrack"></div><div class="tthumb"></div></label></div>
      <div class="cfg-row"><span class="c-lbl">Puntos flotantes</span><label class="toggle"><input type="checkbox" id="pts-tog" checked><div class="ttrack"></div><div class="tthumb"></div></label></div>
      <div class="cfg-row"><span class="c-lbl">Mostrar combo</span><label class="toggle"><input type="checkbox" id="combo-tog" checked><div class="ttrack"></div><div class="tthumb"></div></label></div>
      <div class="cfg-row"><span class="c-lbl">Color entorno</span><div class="color-opts" id="room-colors"><div class="color-opt active" data-c="#1a0a2e" style="background:#1a0a2e"></div><div class="color-opt" data-c="#0a1a2e" style="background:#0a1a2e"></div><div class="color-opt" data-c="#0a2e0a" style="background:#0a2e0a"></div><div class="color-opt" data-c="#1a1a1a" style="background:#1a1a1a"></div></div></div>
    </div>
    <div class="cfg-group">
      <div class="cg-title">‚ô™ AUDIO</div>
      <div class="cfg-row"><span class="c-lbl">Sonido disparo</span><label class="toggle"><input type="checkbox" id="snd-shot" checked><div class="ttrack"></div><div class="tthumb"></div></label></div>
      <div class="cfg-row"><span class="c-lbl">Sonido acierto</span><label class="toggle"><input type="checkbox" id="snd-hit" checked><div class="ttrack"></div><div class="tthumb"></div></label></div>
      <div class="cfg-row"><span class="c-lbl">Sonido fallo</span><label class="toggle"><input type="checkbox" id="snd-miss"><div class="ttrack"></div><div class="tthumb"></div></label></div>
      <div class="cfg-row"><span class="c-lbl">Volumen</span><div class="sl-wrap"><input type="range" id="vol-sl" min="0" max="100" value="70"><span class="sv" id="vol-v">70%</span></div></div>
    </div>
  </div>
  <div class="cfg-footer"><button class="btn btn-s" id="cfg-reset">RESTABLECER</button><button class="btn btn-p" id="cfg-save">GUARDAR Y VOLVER</button></div>
</div>
<!-- RESULTS -->
<div class="screen hidden" id="results-screen">
  <h2>RESULTADOS</h2>
  <div class="grade" id="grade-el">‚Äî</div>
  <div class="stats-grid">
    <div class="stat-card"><div class="s-val" id="r-score">0</div><div class="s-lbl">PUNTUACI√ìN</div></div>
    <div class="stat-card"><div class="s-val" id="r-acc">0%</div><div class="s-lbl">PRECISI√ìN</div></div>
    <div class="stat-card"><div class="s-val" id="r-hits">0</div><div class="s-lbl">ACIERTOS</div></div>
    <div class="stat-card"><div class="s-val" id="r-misses">0</div><div class="s-lbl">FALLOS</div></div>
    <div class="stat-card"><div class="s-val" id="r-combo">0</div><div class="s-lbl">MEJOR COMBO</div></div>
    <div class="stat-card"><div class="s-val" id="r-mode">‚Äî</div><div class="s-lbl">MODO</div></div>
  </div>
  <div class="btn-row"><button class="btn btn-p" id="play-again-btn">JUGAR DE NUEVO</button><button class="btn btn-s" id="menu-btn">MEN√ö</button></div>
</div>
<!-- ONLINE SCREENS -->
<div class="screen hidden" id="duel-lobby-screen" style="gap:0;background:radial-gradient(ellipse at center,rgba(255,61,113,.07) 0%,transparent 70%)">
  <div class="login-logo">
    <h1 style="color:#ff3d71;animation:glow 3s ease-in-out infinite">‚öî ONLINE</h1>
    <p style="letter-spacing:.4em;color:var(--dim)">SALAS MULTIJUGADOR ¬∑ INA MAP</p>
    <div style="display:flex;align-items:center;gap:6px;margin-top:6px">
      <span style="width:7px;height:7px;border-radius:50%;background:#00ff88;box-shadow:0 0 6px #00ff88;display:inline-block;animation:ping-pulse 2s infinite"></span>
      <span style="font-size:.58rem;letter-spacing:.2em;color:#00ff88"><span id="lobby-online-count">‚Äî</span> JUGANDO AHORA</span>
    </div>
  </div>
  <div style="display:flex;align-items:center;gap:8px;margin-bottom:10px">
    <span id="lobby-conn-dot" style="width:8px;height:8px;border-radius:50%;background:#666;display:inline-block;transition:background .3s"></span>
    <span id="lobby-conn-label" style="font-size:.55rem;letter-spacing:.2em;color:var(--dim)">CONECTANDO...</span>
  </div>
  <div style="max-width:680px;width:100%;padding:0 20px">
    <div style="display:flex;gap:8px;margin-bottom:14px;justify-content:center;flex-wrap:wrap">
      <button class="login-btn" id="duel-open-create" style="background:#ff3d71;border:none;color:#fff;font-family:'Orbitron',monospace;font-size:.78rem;font-weight:900;letter-spacing:.2em;padding:10px 24px;cursor:pointer;clip-path:polygon(8px 0,100% 0,calc(100% - 8px) 100%,0 100%)">+ CREAR SALA</button>
      <button class="extra-btn" id="duel-refresh-rooms">&#8635; ACTUALIZAR</button>
      <button class="extra-btn" id="duel-lobby-back">&#8592; VOLVER</button>
    </div>
    <div id="duel-room-list" style="display:flex;flex-direction:column;gap:7px;max-height:50vh;overflow-y:auto;padding-right:4px"></div>
    <div class="auth-msg error" id="duel-lobby-err" style="margin-top:10px;text-align:center"></div>
  </div>
</div>
<div class="screen hidden" id="duel-create-screen" style="gap:0">
  <div class="auth-box" style="border-color:rgba(255,61,113,.3);width:410px">
    <div style="padding:20px 28px 0;font-family:'Orbitron',monospace;font-size:.88rem;letter-spacing:.25em;color:#ff3d71;text-align:center">&#10022; CREAR SALA</div>
    <div class="auth-panel" style="gap:12px">
      <div class="field-wrap"><label>NOMBRE DE LA SALA</label><input class="auth-input no-icon" id="duel-room-name" placeholder="Ej: La sala de ina..." maxlength="30" autocomplete="off"></div>
      <div class="field-wrap"><label>MODO DE JUEGO</label><div style="display:flex;gap:6px;flex-wrap:wrap" id="duel-mode-pills"><button class="diff-btn act" data-mode="1v1">1v1</button><button class="diff-btn" data-mode="2v2">2v2</button><button class="diff-btn" data-mode="3v3">3v3</button><button class="diff-btn" data-mode="4v4">4v4</button><button class="diff-btn" data-mode="ffa">FFA</button></div></div>
      <div class="field-wrap"><label style="display:flex;align-items:center;gap:10px;cursor:pointer"><label class="toggle" style="flex-shrink:0"><input type="checkbox" id="duel-is-private"><div class="ttrack"></div><div class="tthumb"></div></label>SALA PRIVADA (con contrase√±a)</label></div>
      <div class="field-wrap" id="duel-password-wrap" style="display:none"><label>CONTRASE√ëA</label><input class="auth-input no-icon" id="duel-room-password" type="password" placeholder="Contrase√±a..." maxlength="20"></div>
      <div class="auth-msg error" id="duel-create-err"></div>
      <button class="auth-submit" id="duel-do-create" style="background:#ff3d71"><span class="btn-text">&#9889; CREAR Y ENTRAR</span><div class="btn-loader"><div class="spinner"></div></div></button>
      <button style="background:none;border:1px solid var(--border);color:var(--dim);font-family:'Share Tech Mono',monospace;font-size:.6rem;letter-spacing:.15em;padding:9px;cursor:pointer;transition:all .2s;width:100%" id="duel-create-back-btn">&#8592; VOLVER</button>
    </div>
  </div>
</div>
<div class="screen hidden" id="duel-waiting-screen" style="gap:10px">
  <div style="font-family:'Orbitron',monospace;font-size:1.4rem;letter-spacing:.3em;color:#ff3d71;text-shadow:0 0 20px #ff3d71">&#9203; SALA DE ESPERA</div>
  <div id="duel-room-info" style="font-size:.6rem;letter-spacing:.2em;color:var(--dim)"></div>
  <div id="duel-players-in-room" style="display:flex;flex-direction:column;gap:5px;min-width:320px;max-width:500px;width:90%"></div>
  <div style="font-size:.55rem;letter-spacing:.2em;color:var(--dim);margin-top:2px">COMPARTE EL LINK:</div>
  <div id="duel-share-url" style="font-size:.6rem;color:var(--accent3);background:rgba(0,229,255,.06);border:1px solid rgba(0,229,255,.2);padding:10px 18px;max-width:520px;word-break:break-all;text-align:center">cargando...</div>
  <div style="width:100%;max-width:500px">
    <div style="font-size:.5rem;letter-spacing:.25em;color:var(--dim);margin-bottom:5px">üí¨ CHAT DE SALA</div>
    <div id="duel-chat-msgs" style="background:rgba(5,8,15,.85);border:1px solid var(--border);height:100px;overflow-y:auto;padding:8px 10px;display:flex;flex-direction:column;gap:3px;margin-bottom:6px;clip-path:polygon(0 0,calc(100% - 6px) 0,100% 6px,100% 100%,6px 100%,0 calc(100% - 6px))"></div>
    <div style="display:flex;gap:6px">
      <input id="duel-chat-input" class="auth-input no-icon" style="flex:1;padding:8px 11px;font-size:.65rem" placeholder="Escribe algo..." maxlength="80" autocomplete="off">
      <button onclick="onSendChat()" style="background:rgba(255,61,113,.15);border:1px solid rgba(255,61,113,.4);color:#ff3d71;font-family:'Orbitron',monospace;font-size:.6rem;font-weight:700;padding:8px 13px;cursor:pointer;clip-path:polygon(5px 0,100% 0,calc(100% - 5px) 100%,0 100%);transition:all .15s;letter-spacing:.1em" onmouseover="this.style.background='rgba(255,61,113,.3)'" onmouseout="this.style.background='rgba(255,61,113,.15)'">ENVIAR</button>
    </div>
  </div>
  <div style="display:flex;gap:8px;margin-top:4px">
    <button class="auth-submit" id="duel-force-start" style="background:#ff3d71;width:auto;padding:10px 20px;display:none;clip-path:polygon(8px 0,100% 0,calc(100% - 8px) 100%,0 100%)">&#9654; INICIAR PARTIDA</button>
    <button class="btn btn-s" id="duel-waiting-back">&#10005; SALIR</button>
  </div>
</div>
<div class="screen hidden" id="duel-gameover-screen" style="gap:18px">
  <div id="duel-go-title" style="font-family:'Orbitron',monospace;font-size:3.2rem;font-weight:900"></div>
  <div id="duel-go-vs" style="font-size:.72rem;letter-spacing:.2em;color:var(--dim)"></div>
  <div id="duel-go-score" style="font-family:'Orbitron',monospace;font-size:1.6rem;font-weight:700;color:var(--accent)"></div>
  <div style="display:flex;gap:10px;margin-top:8px">
    <button class="auth-submit" id="duel-rematch-btn" style="width:200px;background:#ff3d71">‚Ü∫ REVANCHA</button>
    <button style="width:200px;background:transparent;border:1px solid var(--border);color:var(--text);font-family:'Orbitron',monospace;font-size:.72rem;font-weight:700;letter-spacing:.2em;padding:13px;cursor:pointer;clip-path:polygon(8px 0,100% 0,calc(100% - 8px) 100%,0 100%)" id="duel-menu-btn">‚ò∞ MEN√ö</button>
  </div>
</div>
<!-- 1v1 CANVAS + HUD -->
<canvas id="duel-canvas" style="position:fixed;inset:0;display:none;cursor:none;z-index:5"></canvas>
<div id="duel-crosshair" style="position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);pointer-events:none;z-index:50;display:none">
  <div style="width:20px;height:2px;background:#fff;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)"></div>
  <div style="width:2px;height:20px;background:#fff;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)"></div>
  <div style="width:3px;height:3px;background:#fff;border-radius:50%;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)"></div>
</div>
<div id="duel-hit-flash" style="position:fixed;inset:0;background:radial-gradient(ellipse at center,rgba(255,61,113,.35) 0%,transparent 70%);pointer-events:none;z-index:52;opacity:0;transition:opacity .08s"></div>
<div id="duel-damage-flash"></div>
<div id="duel-death-vignette" style="position:fixed;inset:0;background:rgba(255,0,0,.25);pointer-events:none;z-index:53;display:none"></div>
<div id="duel-respawn-msg" style="position:fixed;top:56%;left:50%;transform:translateX(-50%);font-family:'Orbitron',monospace;font-size:1.1rem;letter-spacing:.3em;color:#ff3d71;text-shadow:0 0 14px #ff3d71;z-index:60;display:none">üíÄ REAPARECIENDO...</div>
<div id="duel-kill-notif" style="position:fixed;top:42%;left:50%;transform:translate(-50%,-50%);pointer-events:none;z-index:60;opacity:0;transition:opacity .15s;text-align:center">
  <div style="font-family:'Orbitron',monospace;font-size:2.2rem;font-weight:900;color:var(--green);text-shadow:0 0 20px var(--green)">¬°ELIMINADO!</div>
  <div style="font-size:.62rem;letter-spacing:.3em;color:var(--dim)">+1 KILL</div>
</div>
<div id="duel-hud" style="position:fixed;inset:0;pointer-events:none;z-index:40;display:none">
  <div style="position:absolute;top:14px;left:50%;transform:translateX(-50%);display:flex;align-items:center;gap:16px;background:rgba(5,8,15,.88);border:1px solid rgba(255,61,113,.2);padding:10px 22px;clip-path:polygon(0 0,calc(100% - 10px) 0,100% 10px,100% 100%,10px 100%,0 calc(100% - 10px))">
    <div style="text-align:center"><div style="font-size:.48rem;letter-spacing:.2em;color:var(--dim)" id="duel-my-name-hud">YO</div><div style="font-family:'Orbitron',monospace;font-size:2.4rem;font-weight:900;color:#ff4444;text-shadow:0 0 12px #ff4444;line-height:1" id="duel-my-kills">0</div><div style="font-size:.48rem;letter-spacing:.2em;color:var(--dim)">HP</div><div style="font-family:'Orbitron',monospace;font-size:1.2rem;font-weight:700;color:#00ff88" id="duel-my-hp">100</div></div>
    <div style="text-align:center;color:var(--dim);font-size:.7rem">‚öî<br><span style="font-size:.4rem;letter-spacing:.2em">FIRST TO <span id="duel-firstto">6</span></span></div>
    <div style="text-align:center"><div style="font-size:.48rem;letter-spacing:.2em;color:var(--dim)" id="duel-opp-name-hud">RIVAL</div><div style="font-family:'Orbitron',monospace;font-size:2.4rem;font-weight:900;color:#4488ff;text-shadow:0 0 12px #4488ff;line-height:1" id="duel-opp-kills">0</div><div style="font-size:.48rem;letter-spacing:.2em;color:var(--dim)">HP</div><div style="font-family:'Orbitron',monospace;font-size:1.2rem;font-weight:700;color:#00ff88" id="duel-opp-hp">100</div></div>
  </div>
  <div style="position:absolute;bottom:14px;left:16px;font-size:.55rem;letter-spacing:.15em;color:var(--dim)">EQUIPO: <span id="duel-team-label" style="font-weight:700">‚Äî</span></div>
  <div style="position:absolute;top:14px;right:16px;display:flex;flex-direction:column;align-items:flex-end;gap:4px">
    <div style="font-family:'Orbitron',monospace;font-size:.75rem;color:var(--green)" id="duel-fps-hud">‚Äî FPS</div>
    <div style="font-family:'Orbitron',monospace;font-size:.75rem" id="duel-ping-hud">‚Äî MS</div>
    <div id="duel-conn-quality" style="font-size:.48rem;letter-spacing:.15em;padding:2px 7px;border-radius:3px;background:rgba(58,74,106,.3);color:var(--dim)">‚óè ‚Äî</div>
  </div>
  <div id="duel-kill-feed" style="position:absolute;top:82px;right:14px;display:flex;flex-direction:column;gap:4px"></div>
  <div style="position:absolute;bottom:14px;right:16px;font-size:.48rem;letter-spacing:.12em;color:var(--dim);text-align:right;line-height:1.8">WASD MOVER ¬∑ MOUSE APUNTAR ¬∑ CLIC DISPARAR ¬∑ ESPACIO SALTAR</div>
</div>
<div id="duel-mobile-controls">
  <div id="duel-joy-zone" style="position:absolute;left:0;bottom:0;width:50%;height:55%;pointer-events:all;"></div>
  <div id="duel-joy-base" style="position:absolute;width:120px;height:120px;border-radius:50%;background:rgba(255,255,255,.08);border:2px solid rgba(255,61,113,.4);transform:translate(-50%,-50%);display:none;"></div>
  <div id="duel-joy-knob" style="position:absolute;width:50px;height:50px;border-radius:50%;background:rgba(255,61,113,.7);box-shadow:0 0 18px rgba(255,61,113,.5);border:2px solid rgba(255,61,113,.9);transform:translate(-50%,-50%);display:none;"></div>
  <div id="duel-look-zone" style="position:absolute;right:0;bottom:0;width:50%;height:100%;pointer-events:all;"></div>
  <div id="duel-btn-fire" style="position:absolute;right:24px;bottom:90px;width:80px;height:80px;border-radius:50%;background:rgba(255,61,113,.25);border:3px solid rgba(255,61,113,.7);color:#ff3d71;font-size:1.8rem;display:flex;align-items:center;justify-content:center;pointer-events:all;cursor:pointer;-webkit-tap-highlight-color:transparent;user-select:none;">üî¥</div>
  <div id="duel-btn-jump" style="position:absolute;right:120px;bottom:90px;width:60px;height:60px;border-radius:50%;background:rgba(0,229,255,.15);border:2px solid rgba(0,229,255,.5);color:#00e5ff;font-size:1.3rem;display:flex;align-items:center;justify-content:center;pointer-events:all;cursor:pointer;-webkit-tap-highlight-color:transparent;user-select:none;">‚¨Ü</div>
  <button id="duel-btn-pause-mob" style="position:absolute;top:80px;left:50%;transform:translateX(-50%);background:rgba(5,8,15,.75);border:1px solid rgba(255,61,113,.3);color:#ff3d71;font-family:'Orbitron',monospace;font-size:.62rem;letter-spacing:.2em;padding:8px 16px
